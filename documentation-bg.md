# ЕКГ анализ с използване на математически анализ

## Резюме

Този проект демонстрира приложението на математическия анализ (калкулус) за анализ на електрокардиографски (ЕКГ) данни. Проектът включва генериране на синтетични ЕКГ данни, извличане на ключови характеристики чрез диференциране, анализ на локални екстремуми, изследване на изпъкналост/вдлъбнатост на сигнала и изчисляване на сърдечна честота.

## Съдържание

1. [Въведение](#въведение)
2. [Инсталация и настройка](#инсталация-и-настройка)
3. [Структура на проекта](#структура-на-проекта)
4. [Теоретична основа](#теоретична-основа)
5. [Основни функции](#основни-функции)
6. [Примери за използване](#примери-за-използване)
7. [Разширения и симулации на патологии](#разширения-и-симулации-на-патологии)
8. [Заключения](#заключения)
9. [Референции](#референции)

## Въведение

Електрокардиографията (ЕКГ) е метод за записване на електрическата активност на сърцето през време. ЕКГ сигналът представлява едномерна функция на времето, което го прави идеално подходящ за анализ чрез методите на калкулуса. В този проект прилагаме концепции като производни, локални екстремуми и анализ на кривина за изследване на ЕКГ сигнали.

## Инсталация и настройка

За да използвате този код, ще са ви необходими следните библиотеки:

```bash
pip install numpy matplotlib scipy
```

## Структура на проекта

Основният Jupyter Notebook съдържа следните компоненти:

1. Генериране на синтетични ЕКГ данни
2. Анализ на локални екстремуми
3. Изчисляване и анализ на производни
4. Оценка на сърдечна честота
5. Симулация на патологични ЕКГ записи

## Теоретична основа

### ЕКГ компоненти

Нормалният ЕКГ сигнал се състои от следните ключови компоненти:

- **P-вълна**: Представя деполяризация на предсърдията
- **QRS комплекс**: Представя деполяризация на камерите
  - **Q-вълна**: Начална отрицателна дефлекция
  - **R-пик**: Главен положителен пик
  - **S-вълна**: Отрицателна дефлекция след R-пика
- **T-вълна**: Представя реполяризация на камерите

### Приложение на калкулуса

В този проект прилагаме следните концепции от калкулуса:

1. **Локални екстремуми**: Точки, където първата производна е нула
   - **Локални максимуми**: Точки, където първата производна е нула и втората производна е отрицателна
   - **Локални минимуми**: Точки, където първата производна е нула и втората производна е положителна

2. **Производни**:
   - **Първа производна**: Скорост на промяна на ЕКГ сигнала
   - **Втора производна**: Кривина/изпъкналост на сигнала

## Основни функции

### Генериране на ЕКГ данни

```python
def generate_synthetic_ekg(duration=10, sampling_rate=500, heart_rate=70):
    """
    Генерира синтетични ЕКГ данни
    
    Parameters:
    - duration: продължителност на ЕКГ записа в секунди
    - sampling_rate: честота на семплиране в Hz
    - heart_rate: сърдечен ритъм в удари в минута
    
    Returns:
    - времева ос
    - ЕКГ сигнал
    """
```

### Намиране на локални екстремуми

```python
def find_extrema(signal, threshold=0.1):
    """
    Намира локалните максимуми и минимуми на сигнала
    
    Parameters:
    - signal: ЕКГ сигнал
    - threshold: праг за откриване на пикове
    
    Returns:
    - местоположения на максимумите
    - местоположения на минимумите
    """
```

### Изчисляване на производни

```python
def compute_derivatives(t, signal):
    """
    Изчислява първата и втората производна на ЕКГ сигнала
    
    Parameters:
    - t: времева ос
    - signal: ЕКГ сигнал
    
    Returns:
    - първа производна
    - втора производна
    """
```

### Анализ на изпъкналост/вдлъбнатост

```python
def analyze_concavity(second_derivative):
    """
    Анализира изпъкналост/вдлъбнатост на графиката базирано на втората производна
    
    Parameters:
    - second_derivative: втора производна на сигнала
    
    Returns:
    - индекси на изпъкналите части (втора производна < 0)
    - индекси на вдлъбнатите части (втора производна > 0)
    """
```

### Измерване на сърдечната честота

```python
def calculate_heart_rate(t, ekg_signal, threshold=0.5):
    """
    Изчислява сърдечната честота от R-пиковете на ЕКГ сигнала
    
    Parameters:
    - t: времева ос
    - ekg_signal: ЕКГ сигнал
    - threshold: праг за откриване на R-пикове
    
    Returns:
    - средна сърдечна честота в удари в минута (BPM)
    - моментна сърдечна честота от всеки R-R интервал
    """
```

## Примери за използване

```python
# Генериране на синтетични ЕКГ данни
t, ekg_signal = generate_synthetic_ekg(duration=5, heart_rate=70)

# Намиране на локални екстремуми
maxima_indices, minima_indices = find_extrema(ekg_signal, threshold=0.1)

# Изчисляване на производните
first_deriv, second_deriv = compute_derivatives(t, ekg_signal)

# Анализ на изпъкналост/вдлъбнатост
convex_indices, concave_indices = analyze_concavity(second_deriv)

# Изчисляване на сърдечната честота
mean_heart_rate, instant_heart_rate, r_peaks = calculate_heart_rate(t, ekg_signal, threshold=0.5)
```

## Разширения и симулации на патологии

Проектът включва генериране и анализ на патологични ЕКГ записи:

1. **ЕКГ с аритмия (нерегулярен ритъм)**:
   ```python
   t_arrhythmic, ekg_arrhythmic = generate_arrhythmic_ekg(duration=10, base_hr=70, hr_variability=30)
   ```

2. **ЕКГ с пропуснати удари**:
   ```python
   t_skipped, ekg_skipped = generate_skipped_beats_ekg(duration=10, heart_rate=70, skip_probability=0.3)
   ```

## Заключения

1. Локалните екстремуми (максимуми и минимуми) съответстват на ключови точки в ЕКГ сигнала:
   - R-пик: главен позитивен максимум
   - Q и S точки: локални минимуми около R-пика
   - P и T вълни: по-малки максимуми

2. Първата производна (df/dt) показва скоростта на промяна на сигнала:
   - Стръмни участъци в ЕКГ имат висока положителна производна
   - Низходящите участъци имат отрицателна производна
   - Нулева първа производна съответства на локалните екстремуми

3. Втората производна (d²f/dt²) разкрива изпъкналостта/вдлъбнатостта на сигнала:
   - Отрицателна втора производна: изпъкнала част (върхове на вълните)
   - Положителна втора производна: вдлъбната част (долини на вълните)

4. Анализът на вариабилността на сърдечната честота показва значителни разлики между различните типове ЕКГ записи.

## Референции

1. Malmivuo, J., & Plonsey, R. (1995). *Bioelectromagnetism: Principles and Applications of Bioelectric and Biomagnetic Fields*. Oxford University Press.
2. Goldberger, A. L., Amaral, L. A., Glass, L., Hausdorff, J. M., Ivanov, P. C., Mark, R. G., ... & Stanley, H. E. (2000). PhysioBank, PhysioToolkit, and PhysioNet: components of a new research resource for complex physiologic signals. *Circulation*, 101(23), e215-e220.
3. Pan, J., & Tompkins, W. J. (1985). A real-time QRS detection algorithm. *IEEE Transactions on Biomedical Engineering*, (3), 230-236.
